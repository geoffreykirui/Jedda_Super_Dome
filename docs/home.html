<head>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=no" />
    <meta charset="utf-8">

    <link rel="stylesheet" href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/style.min.css" type="text/css">
    <script src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/viewer3D.min.js"></script>
    
    <script src="my-awesome-extension.js"></script>
    
    <style>
        body {
            margin: 0;
        }
        #forgeViewer {
            width: 100%;
            height: 100%;
            margin: 0;
            background-color: #F0F8FF;
        }
    </style>
</head>
<body>

    <div id="forgeViewer"></div>
    <script>
        var viewer;
var options = {
    env: 'AutodeskProduction2',
    api: 'streamingV2_EU',  // for models uploaded to EMEA change this option to 'streamingV2_EU'
    getAccessToken: function(onTokenReady) {
        var token = 'eyJhbGciOiJSUzI1NiIsImtpZCI6IlU3c0dGRldUTzlBekNhSzBqZURRM2dQZXBURVdWN2VhIn0.eyJzY29wZSI6WyJjb2RlOmFsbCIsImRhdGE6d3JpdGUiLCJkYXRhOnJlYWQiLCJidWNrZXQ6Y3JlYXRlIiwiYnVja2V0OmRlbGV0ZSIsImJ1Y2tldDpyZWFkIl0sImNsaWVudF9pZCI6Ik1FMm1MaUFwNk9ycWlBUEx4Q2hkd3hQRFVWYk5GVUs0IiwiYXVkIjoiaHR0cHM6Ly9hdXRvZGVzay5jb20vYXVkL2Fqd3RleHA2MCIsImp0aSI6InBnYlI3S3BEeUZiY1FtandUUUg5Vk4zVkdVR2Q5RVU5TndPSEFyZ3BSRFJDT2tqZW5EOG1nY1lGY24xMnJXYVAiLCJleHAiOjE2NTA3MDc4Njh9.goGkw9_D5ZZ-PiJUZj5YHwVjw6EC52-FE4GTit3vrqbJDiruXjhn0t2zB3qrK7a2joqKKZ_0s42tC3WLk2HW-R2qyhfk7YZ-pekJaKLUKZPBWo3n5QtcbEl1_LDLB0JoZSVFffV12NfKkYJ6rFtlxsYqNIEbFjbRr5Wh2grprRpCHsVdguAC0jWXoT_mID6pL_3JbXixCkMrwZszrKGqPXJbclMA-NfFvadBkULOl-RpIIgqj17ZpldX24gTJo8Tih1lDsPjPIfrUgr4U2gk2zpijxhwZakk7Y6qxASjzLCgtrOv5uRgQGNWfsX1EadEBLAIyt-cca2f1vuAvE2e7w';
        var timeInSeconds = 3599; // Use value provided by Forge Authentication (OAuth) API
        onTokenReady(token, timeInSeconds);
    }
};

Autodesk.Viewing.Initializer(options, function() {

    var htmlDiv = document.getElementById('forgeViewer');
    viewer = new Autodesk.Viewing.GuiViewer3D(htmlDiv);
    var startedCode = viewer.start();
    if (startedCode > 0) {
        console.error('Failed to create a Viewer: WebGL not supported.');
        return;
    }

    console.log('Initialization complete, loading a model next...');

});
var documentId = 'urn:dXJuOmFkc2sub2JqZWN0czpvcy5vYmplY3Q6YnVja2V0M2QvSmVkZGFoJTIwU3VwZXIlMjBEb21lX0VfMTItMV8wMDEuemlw';
Autodesk.Viewing.Document.load(documentId, onDocumentLoadSuccess, onDocumentLoadFailure);

function onDocumentLoadSuccess(viewerDocument) {
    // viewerDocument is an instance of Autodesk.Viewing.Document
}

function onDocumentLoadFailure() {
    console.error('Failed fetching Forge manifest');
}

// Content for 'my-awesome-extension.js'

function MyAwesomeExtension(viewer, options) {
  Autodesk.Viewing.Extension.call(this, viewer, options);
}

MyAwesomeExtension.prototype = Object.create(Autodesk.Viewing.Extension.prototype);
MyAwesomeExtension.prototype.constructor = MyAwesomeExtension;

MyAwesomeExtension.prototype.load = function() {
  alert('MyAwesomeExtension is loaded!');
  return true;
};

MyAwesomeExtension.prototype.unload = function() {
  alert('MyAwesomeExtension is now unloaded!');
  return true;
};

Autodesk.Viewing.theExtensionManager.registerExtension('MyAwesomeExtension', MyAwesomeExtension);

//Load the extension
var config3d = {
  ...
  extensions: ['MyAwesomeExtension'],
  ...
};
var htmlDiv = document.getElementById('forgeViewer')
viewer = new Autodesk.Viewing.GuiViewer3D(htmlDiv, config3d);
viewer.start();
...
viewer.loadModel(...);


//Add button dandlers
<div id="forgeViewer"></div>
<button id="MyAwesomeLockButton">Lock it!</button>
<button id="MyAwesomeUnlockButton">Unlock it!</button>


//Add button handlers
MyAwesomeExtension.prototype.load = function() {
  // alert('MyAwesomeExtension is loaded!');

  var viewer = this.viewer;

  var lockBtn = document.getElementById('MyAwesomeLockButton');
  lockBtn.addEventListener('click', function() {
    viewer.setNavigationLock(true);
  });

  var unlockBtn = document.getElementById('MyAwesomeUnlockButton');
  unlockBtn.addEventListener('click', function() {
    viewer.setNavigationLock(false);
  });

  return true;
};

//Cleanup on unload
function MyAwesomeExtension(viewer, options) {
  Autodesk.Viewing.Extension.call(this, viewer, options);

  // Preserve "this" reference when methods are invoked by event handlers.
  this.lockViewport = this.lockViewport.bind(this);
  this.unlockViewport = this.unlockViewport.bind(this);
}

MyAwesomeExtension.prototype = Object.create(Autodesk.Viewing.Extension.prototype);
MyAwesomeExtension.prototype.constructor = MyAwesomeExtension;

MyAwesomeExtension.prototype.lockViewport = function() {
  this.viewer.setNavigationLock(true);
};

MyAwesomeExtension.prototype.unlockViewport = function() {
  this.viewer.setNavigationLock(false);
};

MyAwesomeExtension.prototype.load = function() {
  // alert('MyAwesomeExtension is loaded!');

  this._lockBtn = document.getElementById('MyAwesomeLockButton');
  this._lockBtn.addEventListener('click', this.lockViewport);

  this._unlockBtn = document.getElementById('MyAwesomeUnlockButton');
  this._unlockBtn.addEventListener('click', this.unlockViewport);

  return true;
};

 MyAwesomeExtension.prototype.unload = function() {
  // alert('MyAwesomeExtension is now unloaded!');

  if (this._lockBtn) {
    this._lockBtn.removeEventListener('click', this.lockViewport);
    this._lockBtn = null;
  }

  if (this._unlockBtn) {
      this._unlockBtn.removeEventListener('click', this.unlockViewport);
      this._unlockBtn = null;
  }

  return true;
};

//Test the extension From the browserâ€™s console type the following to check whether your extension is loaded or not. At this point, the extension should be loaded and the function call should return true:
// NOP_VIEWER.isExtensionLoaded('MyAwesomeExtension');
// Note the use of the global variable NOP_VIEWER, defined by the Viewer SDK after developers create a Viewer instance. Now type the following to unload the extension:

// NOP_VIEWER.unloadExtension('MyAwesomeExtension');
//If all goes as expected, the added buttons should no longer work. Click on them to validate. You can then load the extension again by calling

// NOP_VIEWER.loadExtension('MyAwesomeExtension');
// Now the added buttons will again work as expected.

// Enabling memory management
var config3d = {
    ...
    loaderExtensions: { svf: "Autodesk.MemoryLimited" }
    ...
};
var htmlDiv = document.getElementById('forgeViewer');
viewer = new Autodesk.Viewing.GuiViewer3D(htmlDiv, config3d);
viewer.start();
...
viewer.loadModel(...);

//Debugging
viewer.loadExtension('Autodesk.Viewing.MemoryLimitedDebug');



    </script>

</body>
